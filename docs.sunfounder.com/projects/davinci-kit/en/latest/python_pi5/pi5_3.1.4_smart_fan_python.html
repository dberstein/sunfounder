

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="readthedocs-addons-api-version" content="1"><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3.1.4 Smart Fan &mdash; SunFounder davinci-kit-for-raspberry-pi  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css%3Fv=80d5e7a1.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css%3Fv=e59714d7.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css%3Fv=76b2166b.css" />
      <link rel="stylesheet" type="text/css" href="https://ezblock.cc/readDocFile/custom.css" />
      <link rel="stylesheet" type="text/css" href="https://ezblock.cc/readDocFile/readTheDoc/src/css/index.css" />
      <link rel="stylesheet" type="text/css" href="https://ezblock.cc/readDocFile/readTheDoc/src/css/xterm.css" />

  
      <script src="../_static/jquery.js%3Fv=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js%3Fv=2cd50e6c"></script>
      <script src="../_static/documentation_options.js%3Fv=5929fcd5"></script>
      <script src="../_static/doctools.js%3Fv=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js%3Fv=dc90522c"></script>
      <script src="../_static/clipboard.min.js%3Fv=a7894cd8"></script>
      <script src="../_static/copybutton.js%3Fv=f281be69"></script>
      <script src="https://ezblock.cc/readDocFile/custom.js"></script>
      <script src="https://docs.sunfounder.com/projects/davinci-kit/en/latest/_static/lang.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/ace.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/ext-language_tools.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/theme-chrome.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/mode-python.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/mode-sh.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/monokai.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/xterm.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/FitAddon.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/readTheDocIndex.js"></script>
    <script src="../_static/js/theme.js"></script>
    <script src="../_static/js/versions.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="3.1.5 Battery Indicator" href="pi5_3.1.5_battery_indicator_python.html" />
    <link rel="prev" title="3.1.3 Reversing Alarm" href="pi5_3.1.3_reversing_alarm_python.html" /> 
<script async type="text/javascript" src="../../../../../_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="davinci-kit" /><meta name="readthedocs-version-slug" content="latest" /><meta name="readthedocs-resolver-filename" content="/python_pi5/pi5_3.1.4_smart_fan_python.html" /><meta name="readthedocs-http-status" content="200" /></head>

<body class="wy-body-for-nav">
<nav id="nav-bar">
  <ul class="nav-bar-items" id="nav-bar-items">
    <li class="nav-bar-logo">
      <a href="https://sunfounder.com">
        <img class="logo-img" src="https://ezblock.cc/readDocFile/sunfounder_LOGO_160x@2x.png"/>
      </a>
    </li>
  </ul>
</nav>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            SunFounder davinci-kit-for-raspberry-pi
          </a>
              <div class="switch-menus">
                <div class="version-switch"></div>
                <div class="language-switch"></div>
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">About this Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../component_list.html">Component List</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpio_extension_board.html">GPIO Extension Board</a></li>
<li class="toctree-l1"><a class="reference internal" href="../download_the_code.html">Download the Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install_setup_os/install_setup_os.html">Install and Setup Raspberry Pi OS</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../for_pi5.html">For Pi 5</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="play_with_python_pi5.html">Play with Python</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="check_the_gpiozero_python.html">Check the <code class="docutils literal notranslate"><span class="pre">GPIO</span> <span class="pre">Zero</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="pi5_output_python.html">Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="pi5_input_python.html">Input</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="pi5_extension_python.html">Extension</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.1_counting_device_python.html">3.1.1 Counting Device</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.2_welcome_python.html">3.1.2 Welcome</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.3_reversing_alarm_python.html">3.1.3 Reversing Alarm</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="pi5_3.1.4_smart_fan_python.html#">3.1.4 Smart Fan</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.5_battery_indicator_python.html">3.1.5 Battery Indicator</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.6_motion_control_python.html">3.1.6 Motion Control</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.7_traffic_light_python.html">3.1.7 Traffic Light</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.8_overheat_monitor_python.html">3.1.8 Overheat Monitor</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.9_password_lock_python.html">3.1.9 Password Lock</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.10_alarm_bell_python.html">3.1.10 Alarm Bell</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.11_morse_code_generator_python.html">3.1.11 Morse Code Generator</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.12_game_guess_number_python.html">3.1.12 GAME– Guess Number</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.13_game_10_second_python.html">3.1.13 GAME - 10 Second</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.14_game_not_not_python.html">3.1.14 GAME– Not Not</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../c_pi5/play_with_c.html">Play with C</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scratch_pi5/play_with_scratch.html">Play with Scratch</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../for_other_models.html">For Pi 4, 3, and All Other Pi Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python_video/python_video.html">Python Video Course</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix.html">Appendix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thank-learning.html">Thank You</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SunFounder davinci-kit-for-raspberry-pi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../for_pi5.html">For Pi 5</a></li>
          <li class="breadcrumb-item"><a href="play_with_python_pi5.html">Play with Python</a></li>
          <li class="breadcrumb-item"><a href="pi5_extension_python.html">Extension</a></li>
      <li class="breadcrumb-item active">3.1.4 Smart Fan</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/python_pi5/pi5_3.1.4_smart_fan_python.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="admonition note">
<p class="admonition-title">Note</p>
<p>Hello, welcome to the SunFounder Raspberry Pi &amp; Arduino &amp; ESP32 Enthusiasts Community on Facebook! Dive deeper into Raspberry Pi, Arduino, and ESP32 with fellow enthusiasts.</p>
<p><strong>Why Join?</strong></p>
<ul class="simple">
<li><p><strong>Expert Support</strong>: Solve post-sale issues and technical challenges with help from our community and team.</p></li>
<li><p><strong>Learn &amp; Share</strong>: Exchange tips and tutorials to enhance your skills.</p></li>
<li><p><strong>Exclusive Previews</strong>: Get early access to new product announcements and sneak peeks.</p></li>
<li><p><strong>Special Discounts</strong>: Enjoy exclusive discounts on our newest products.</p></li>
<li><p><strong>Festive Promotions and Giveaways</strong>: Take part in giveaways and holiday promotions.</p></li>
</ul>
<p>👉 Ready to explore and create with us? Click [<a href="https://bit.ly/raphaelkit " target="_blank">here</a>] and join today!</p>
</div>
<section id="smart-fan">
<span id="py-pi5-fan"></span><h1>3.1.4 Smart Fan<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#smart-fan" title="Link to this heading"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#introduction" title="Link to this heading"></a></h2>
<p>In this project, we will use motors, buttons and thermistors to make a
manual + automatic smart fan whose wind speed is adjustable.</p>
</section>
<section id="required-components">
<h2>Required Components<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#required-components" title="Link to this heading"></a></h2>
<p>In this project, we need the following components.</p>
<a class="reference internal image-reference" href="../_images/4.1.10_smart_fan_list.png"><img alt="../_images/4.1.10_smart_fan_list.png" class="align-center" src="../_images/4.1.10_smart_fan_list.png" style="width: 800px;" />
</a>
</section>
<section id="schematic-diagram">
<h2>Schematic Diagram<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#schematic-diagram" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>T-Board Name</p></td>
<td><p>physical</p></td>
<td><p>wiringPi</p></td>
<td><p>BCM</p></td>
</tr>
<tr class="row-even"><td><p>GPIO17</p></td>
<td><p>Pin 11</p></td>
<td><p>0</p></td>
<td><p>17</p></td>
</tr>
<tr class="row-odd"><td><p>GPIO18</p></td>
<td><p>Pin 12</p></td>
<td><p>1</p></td>
<td><p>18</p></td>
</tr>
<tr class="row-even"><td><p>GPIO27</p></td>
<td><p>Pin 13</p></td>
<td><p>2</p></td>
<td><p>27</p></td>
</tr>
<tr class="row-odd"><td><p>GPIO22</p></td>
<td><p>Pin 15</p></td>
<td><p>3</p></td>
<td><p>22</p></td>
</tr>
<tr class="row-even"><td><p>GPIO5</p></td>
<td><p>Pin 29</p></td>
<td><p>21</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>GPIO6</p></td>
<td><p>Pin 31</p></td>
<td><p>22</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-even"><td><p>GPIO13</p></td>
<td><p>Pin 33</p></td>
<td><p>23</p></td>
<td><p>13</p></td>
</tr>
</tbody>
</table>
<img alt="../_images/4.1.10_smart_fan_schematic.png" class="align-center" src="../_images/4.1.10_smart_fan_schematic.png" />
</section>
<section id="experimental-procedures">
<h2>Experimental Procedures<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#experimental-procedures" title="Link to this heading"></a></h2>
<p><strong>Step 1:</strong> Build the circuit.</p>
<img alt="../_images/4.1.10_smart_fan_circuit.png" src="../_images/4.1.10_smart_fan_circuit.png" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The power module can apply a 9V battery with the 9V Battery
Buckle in the kit. Insert the jumper cap of the power module into the 5V
bus strips of the breadboard.</p>
</div>
<img alt="../_images/4.1.10_smart_fan_battery.jpeg" class="align-center" src="../_images/4.1.10_smart_fan_battery.jpeg" />
<p><strong>Step 2</strong>: Get into the folder of the code.</p>
<run></run><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">davinci</span><span class="o">-</span><span class="n">kit</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="n">raspberry</span><span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="n">python</span><span class="o">-</span><span class="n">pi5</span>
</pre></div>
</div>
<p><strong>Step 3</strong>: Run.</p>
<run></run><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">python3</span> <span class="mf">3.1.4</span><span class="n">_SmartFan</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>As the code runs, start the fan by pressing the button. Every time you
press, 1 speed grade is adjusted up or down. There are <strong>5</strong> kinds of
speed grades: <strong>0~4</strong>. When set to the 4<sup>th</sup> speed grade and you
press the button, the fan stops working with a <strong>0</strong> wind speed.</p>
<p>Once the temperature goes up or down for more than 2℃, the speed
automatically gets 1-grade faster or slower.</p>
</section>
<section id="code">
<h2>Code<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#code" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can <strong>Modify/Reset/Copy/Run/Stop</strong> the code below. But before that, you need to go to  source code path like <code class="docutils literal notranslate"><span class="pre">raphael-kit/python-pi5</span></code>. After modifying the code, you can run it directly to see the effect.</p>
</div>
<run></run><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">from</span> <span class="nn">gpiozero</span> <span class="kn">import</span> <span class="n">Motor</span><span class="p">,</span> <span class="n">Button</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">ADC0834</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># Initialize GPIO pins for the button and motor control</span>
<span class="n">BtnPin</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>
<span class="n">motor</span> <span class="o">=</span> <span class="n">Motor</span><span class="p">(</span><span class="n">forward</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">backward</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

<span class="c1"># Initialize the ADC0834 module for temperature sensing</span>
<span class="n">ADC0834</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

<span class="c1"># Initialize variables to track the motor speed level and temperatures</span>
<span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">currentTemp</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">markTemp</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">temperature</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads and calculates the current temperature from the sensor.</span>
<span class="sd">    Returns:</span>
<span class="sd">        float: The current temperature in Celsius.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Read analog value from the ADC0834 module</span>
    <span class="n">analogVal</span> <span class="o">=</span> <span class="n">ADC0834</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
    <span class="c1"># Convert analog value to voltage and then to resistance</span>
    <span class="n">Vr</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">analogVal</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="n">Rt</span> <span class="o">=</span> <span class="mi">10000</span> <span class="o">*</span> <span class="n">Vr</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">-</span> <span class="n">Vr</span><span class="p">)</span>
    <span class="c1"># Calculate temperature in Celsius</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(((</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Rt</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">))</span> <span class="o">/</span> <span class="mi">3950</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">273.15</span> <span class="o">+</span> <span class="mi">25</span><span class="p">)))</span>
    <span class="n">Cel</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">-</span> <span class="mf">273.15</span>
    <span class="k">return</span> <span class="n">Cel</span>

<span class="k">def</span> <span class="nf">motor_run</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adjusts the motor speed based on the specified level.</span>
<span class="sd">    Args:</span>
<span class="sd">        level (int): Desired motor speed level.</span>
<span class="sd">    Returns:</span>
<span class="sd">        int: Adjusted motor speed level.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Stop the motor if the level is 0</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">motor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="c1"># Cap the level at 4 for maximum speed</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="c1"># Set the motor speed</span>
    <span class="n">motor</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">level</span> <span class="o">/</span> <span class="mi">4</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">level</span>

<span class="k">def</span> <span class="nf">changeLevel</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Changes the motor speed level when the button is pressed and updates the reference temperature.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">level</span><span class="p">,</span> <span class="n">currentTemp</span><span class="p">,</span> <span class="n">markTemp</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Button pressed&quot;</span><span class="p">)</span>
    <span class="c1"># Cycle through levels 0-4</span>
    <span class="n">level</span> <span class="o">=</span> <span class="p">(</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">5</span>
    <span class="c1"># Update the reference temperature</span>
    <span class="n">markTemp</span> <span class="o">=</span> <span class="n">currentTemp</span>

<span class="c1"># Bind the button press event to changeLevel function</span>
<span class="n">BtnPin</span><span class="o">.</span><span class="n">when_pressed</span> <span class="o">=</span> <span class="n">changeLevel</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main function to continuously monitor and respond to temperature changes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">level</span><span class="p">,</span> <span class="n">currentTemp</span><span class="p">,</span> <span class="n">markTemp</span>
    <span class="c1"># Set initial reference temperature</span>
    <span class="n">markTemp</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">()</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Continuously read current temperature</span>
        <span class="n">currentTemp</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">()</span>
        <span class="c1"># Adjust motor level based on temperature difference</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">currentTemp</span> <span class="o">-</span> <span class="n">markTemp</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">markTemp</span> <span class="o">=</span> <span class="n">currentTemp</span>
            <span class="k">elif</span> <span class="n">currentTemp</span> <span class="o">-</span> <span class="n">markTemp</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">level</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">markTemp</span> <span class="o">=</span> <span class="n">currentTemp</span>
        <span class="c1"># Run the motor at the adjusted level</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">motor_run</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>

<span class="c1"># Run the main function and handle KeyboardInterrupt</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
    <span class="c1"># Stop the motor when the script is interrupted</span>
    <span class="n">motor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="code-explanation">
<h2>Code Explanation<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#code-explanation" title="Link to this heading"></a></h2>
<ol class="arabic">
<li><p>Imports classes for managing a motor and a button, and the sleep function for introducing pauses. Additionally, it imports the ADC0834 library for temperature sensing and the math library for mathematical calculations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">from</span> <span class="nn">gpiozero</span> <span class="kn">import</span> <span class="n">Motor</span><span class="p">,</span> <span class="n">Button</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">ADC0834</span>
<span class="kn">import</span> <span class="nn">math</span>
</pre></div>
</div>
</li>
<li><p>Sets up the button on GPIO pin 22 and configures the motor with specific GPIO pins for control. Initializes the ADC0834 module for temperature measurement. Also, initializes variables to monitor the motor speed level and temperatures.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize GPIO pins for the button and motor control</span>
<span class="n">BtnPin</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>
<span class="n">motor</span> <span class="o">=</span> <span class="n">Motor</span><span class="p">(</span><span class="n">forward</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">backward</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

<span class="c1"># Initialize the ADC0834 module for temperature sensing</span>
<span class="n">ADC0834</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

<span class="c1"># Initialize variables to track the motor speed level and temperatures</span>
<span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">currentTemp</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">markTemp</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
<li><p>Defines a function to read and calculate the temperature from the sensor, converting the readout to Celsius.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">temperature</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads and calculates the current temperature from the sensor.</span>
<span class="sd">    Returns:</span>
<span class="sd">        float: The current temperature in Celsius.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Read analog value from the ADC0834 module</span>
    <span class="n">analogVal</span> <span class="o">=</span> <span class="n">ADC0834</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
    <span class="c1"># Convert analog value to voltage and then to resistance</span>
    <span class="n">Vr</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">analogVal</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="n">Rt</span> <span class="o">=</span> <span class="mi">10000</span> <span class="o">*</span> <span class="n">Vr</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">-</span> <span class="n">Vr</span><span class="p">)</span>
    <span class="c1"># Calculate temperature in Celsius</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(((</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Rt</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">))</span> <span class="o">/</span> <span class="mi">3950</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">273.15</span> <span class="o">+</span> <span class="mi">25</span><span class="p">)))</span>
    <span class="n">Cel</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">-</span> <span class="mf">273.15</span>
    <span class="k">return</span> <span class="n">Cel</span>
</pre></div>
</div>
</li>
<li><p>Introduces a function to adjust the motor speed according to the specified level.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">motor_run</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adjusts the motor speed based on the specified level.</span>
<span class="sd">    Args:</span>
<span class="sd">        level (int): Desired motor speed level.</span>
<span class="sd">    Returns:</span>
<span class="sd">        int: Adjusted motor speed level.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Stop the motor if the level is 0</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">motor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="c1"># Cap the level at 4 for maximum speed</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="c1"># Set the motor speed</span>
    <span class="n">motor</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">level</span> <span class="o">/</span> <span class="mi">4</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">level</span>
</pre></div>
</div>
</li>
<li><p>Implements a function to change the motor speed level manually using a button, and binds this function to the button’s press event.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">changeLevel</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Changes the motor speed level when the button is pressed and updates the reference temperature.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">level</span><span class="p">,</span> <span class="n">currentTemp</span><span class="p">,</span> <span class="n">markTemp</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Button pressed&quot;</span><span class="p">)</span>
    <span class="c1"># Cycle through levels 0-4</span>
    <span class="n">level</span> <span class="o">=</span> <span class="p">(</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">5</span>
    <span class="c1"># Update the reference temperature</span>
    <span class="n">markTemp</span> <span class="o">=</span> <span class="n">currentTemp</span>

<span class="c1"># Bind the button press event to changeLevel function</span>
<span class="n">BtnPin</span><span class="o">.</span><span class="n">when_pressed</span> <span class="o">=</span> <span class="n">changeLevel</span>
</pre></div>
</div>
</li>
<li><p>The main function, designed to continually adjust the motor speed in response to temperature fluctuations, remains to be implemented.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main function to continuously monitor and respond to temperature changes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">level</span><span class="p">,</span> <span class="n">currentTemp</span><span class="p">,</span> <span class="n">markTemp</span>
    <span class="c1"># Set initial reference temperature</span>
    <span class="n">markTemp</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">()</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Continuously read current temperature</span>
        <span class="n">currentTemp</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">()</span>
        <span class="c1"># Adjust motor level based on temperature difference</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">currentTemp</span> <span class="o">-</span> <span class="n">markTemp</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">markTemp</span> <span class="o">=</span> <span class="n">currentTemp</span>
            <span class="k">elif</span> <span class="n">currentTemp</span> <span class="o">-</span> <span class="n">markTemp</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">level</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">markTemp</span> <span class="o">=</span> <span class="n">currentTemp</span>
        <span class="c1"># Run the motor at the adjusted level</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">motor_run</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Runs the main function and ensures the motor stops if the script is interrupted.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the main function and handle KeyboardInterrupt</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
    <span class="c1"># Stop the motor when the script is interrupted</span>
    <span class="n">motor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pi5_3.1.3_reversing_alarm_python.html" class="btn btn-neutral float-left" title="3.1.3 Reversing Alarm" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="pi5_3.1.5_battery_indicator_python.html" class="btn btn-neutral float-right" title="3.1.5 Battery Indicator" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, SunFounder.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>