

<!DOCTYPE html>
<html class="writer-html5" lang="it" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="readthedocs-addons-api-version" content="1"><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3.1.4 Ventilatore Intelligente &mdash; SunFounder davinci-kit-for-raspberry-pi  documentazione</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css%3Fv=80d5e7a1.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css%3Fv=e59714d7.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css%3Fv=76b2166b.css" />
      <link rel="stylesheet" type="text/css" href="https://ezblock.cc/readDocFile/custom.css" />
      <link rel="stylesheet" type="text/css" href="https://ezblock.cc/readDocFile/readTheDoc/src/css/index.css" />
      <link rel="stylesheet" type="text/css" href="https://ezblock.cc/readDocFile/readTheDoc/src/css/xterm.css" />

  
      <script src="../_static/jquery.js%3Fv=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js%3Fv=2cd50e6c"></script>
      <script src="../_static/documentation_options.js%3Fv=3fd72285"></script>
      <script src="../_static/doctools.js%3Fv=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js%3Fv=dc90522c"></script>
      <script src="../_static/clipboard.min.js%3Fv=a7894cd8"></script>
      <script src="../_static/copybutton.js%3Fv=f281be69"></script>
      <script src="../_static/translations.js%3Fv=0173e136"></script>
      <script src="https://ezblock.cc/readDocFile/custom.js"></script>
      <script src="https://docs.sunfounder.com/projects/davinci-kit/it/latest/_static/lang.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/ace.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/ext-language_tools.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/theme-chrome.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/mode-python.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/mode-sh.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/monokai.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/xterm.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/FitAddon.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/readTheDocIndex.js"></script>
    <script src="../_static/js/theme.js"></script>
    <script src="../_static/js/versions.js"></script>
    <link rel="index" title="Indice" href="../genindex.html" />
    <link rel="search" title="Cerca" href="../search.html" />
    <link rel="next" title="3.1.5 Indicatore di Batteria" href="pi5_3.1.5_battery_indicator_python.html" />
    <link rel="prev" title="3.1.3 Allarme Retromarcia" href="pi5_3.1.3_reversing_alarm_python.html" /> 
<script async type="text/javascript" src="../../../../../_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="davinci-kit-it" /><meta name="readthedocs-version-slug" content="latest" /><meta name="readthedocs-resolver-filename" content="/python_pi5/pi5_3.1.4_smart_fan_python.html" /><meta name="readthedocs-http-status" content="200" /></head>

<body class="wy-body-for-nav">
<nav id="nav-bar">
  <ul class="nav-bar-items" id="nav-bar-items">
    <li class="nav-bar-logo">
      <a href="https://sunfounder.com">
        <img class="logo-img" src="https://ezblock.cc/readDocFile/sunfounder_LOGO_160x@2x.png"/>
      </a>
    </li>
  </ul>
</nav>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            SunFounder davinci-kit-for-raspberry-pi
          </a>
              <div class="switch-menus">
                <div class="version-switch"></div>
                <div class="language-switch"></div>
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Cerca documenti" aria-label="Cerca documenti" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Menu di navigazione">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">About this Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../component_list.html">Elenco dei Componenti</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpio_extension_board.html">Scheda di Estensione GPIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../download_the_code.html">Scarica il Codice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install_setup_os/install_setup_os.html">Installazione e configurazione di Raspberry Pi OS</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../for_pi5.html">Per Pi 5</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="play_with_python_pi5.html">Divertiti con Python</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="check_the_gpiozero_python.html">Verifica di <code class="docutils literal notranslate"><span class="pre">GPIO</span> <span class="pre">Zero</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="pi5_output_python.html">Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="pi5_input_python.html">Input</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="pi5_extension_python.html">Estensioni</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.1_counting_device_python.html">3.1.1 Dispositivo di Conteggio</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.2_welcome_python.html">3.1.2 Benvenuto</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.3_reversing_alarm_python.html">3.1.3 Allarme Retromarcia</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="pi5_3.1.4_smart_fan_python.html#">3.1.4 Ventilatore Intelligente</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.5_battery_indicator_python.html">3.1.5 Indicatore di Batteria</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.6_motion_control_python.html">3.1.6 Controllo di Movimento</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.7_traffic_light_python.html">3.1.7 Semaforo</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.8_overheat_monitor_python.html">3.1.8 Monitor di Surriscaldamento</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.9_password_lock_python.html">3.1.9 Lucchetto con Password</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.10_alarm_bell_python.html">3.1.10 Campanello di Allarme</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.11_morse_code_generator_python.html">3.1.11 Generatore di Codice Morse</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.12_game_guess_number_python.html">3.1.12 GIOCO – Indovina il Numero</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.13_game_10_second_python.html">3.1.13 GIOCO - 10 Secondi</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.14_game_not_not_python.html">3.1.14 GIOCO – Not Not</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../c_pi5/play_with_c.html">Gioca con C</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scratch_pi5/play_with_scratch.html">Giocare con Scratch</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../for_other_models.html">Per Pi 4, 3 e tutti gli altri modelli Pi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python_video/python_video.html">Corso Video Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix.html">Appendice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thank-learning.html">Grazie</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Menu navigazione dispositivi mobili" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SunFounder davinci-kit-for-raspberry-pi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Naviga tra le pagine">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../for_pi5.html">Per Pi 5</a></li>
          <li class="breadcrumb-item"><a href="play_with_python_pi5.html">Divertiti con Python</a></li>
          <li class="breadcrumb-item"><a href="pi5_extension_python.html">Estensioni</a></li>
      <li class="breadcrumb-item active">3.1.4 Ventilatore Intelligente</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/python_pi5/pi5_3.1.4_smart_fan_python.rst.txt" rel="nofollow"> Visualizza sorgente pagina</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Ciao, benvenuto nella comunità Facebook degli appassionati di SunFounder Raspberry Pi, Arduino e ESP32! Approfondisci l’uso di Raspberry Pi, Arduino e ESP32 con altri appassionati.</p>
<p><strong>Perché unirsi?</strong></p>
<ul class="simple">
<li><p><strong>Supporto Esperto</strong>: Risolvi problemi post-vendita e sfide tecniche con l’aiuto della nostra comunità e del nostro team.</p></li>
<li><p><strong>Impara e Condividi</strong>: Scambia consigli e tutorial per migliorare le tue competenze.</p></li>
<li><p><strong>Anteprime Esclusive</strong>: Ottieni accesso anticipato agli annunci di nuovi prodotti.</p></li>
<li><p><strong>Sconti Esclusivi</strong>: Approfitta di sconti speciali sui nostri prodotti più recenti.</p></li>
<li><p><strong>Promozioni e Omaggi Festivi</strong>: Partecipa a promozioni festive e a giveaway.</p></li>
</ul>
<p>👉 Pronto a esplorare e creare con noi? Clicca su [<a href="https://bit.ly/raphaelkit " target="_blank">Qui</a>] e unisciti oggi stesso!</p>
</div>
<section id="ventilatore-intelligente">
<span id="py-pi5-fan"></span><h1>3.1.4 Ventilatore Intelligente<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#ventilatore-intelligente" title="Link to this heading"></a></h1>
<section id="introduzione">
<h2>Introduzione<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#introduzione" title="Link to this heading"></a></h2>
<p>In questo progetto, utilizzeremo motori, pulsanti e termistori per creare
un ventilatore intelligente manuale + automatico, con velocità regolabile.</p>
</section>
<section id="componenti-necessari">
<h2>Componenti Necessari<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#componenti-necessari" title="Link to this heading"></a></h2>
<p>In questo progetto, avremo bisogno dei seguenti componenti.</p>
<a class="reference internal image-reference" href="../_images/4.1.10_smart_fan_list.png"><img alt="../_images/4.1.10_smart_fan_list.png" class="align-center" src="../_images/4.1.10_smart_fan_list.png" style="width: 800px;" />
</a>
</section>
<section id="diagramma-schematico">
<h2>Diagramma Schematico<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#diagramma-schematico" title="Link to this heading"></a></h2>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>T-Board Name</p></td>
<td><p>physical</p></td>
<td><p>wiringPi</p></td>
<td><p>BCM</p></td>
</tr>
<tr class="row-even"><td><p>GPIO17</p></td>
<td><p>Pin 11</p></td>
<td><p>0</p></td>
<td><p>17</p></td>
</tr>
<tr class="row-odd"><td><p>GPIO18</p></td>
<td><p>Pin 12</p></td>
<td><p>1</p></td>
<td><p>18</p></td>
</tr>
<tr class="row-even"><td><p>GPIO27</p></td>
<td><p>Pin 13</p></td>
<td><p>2</p></td>
<td><p>27</p></td>
</tr>
<tr class="row-odd"><td><p>GPIO22</p></td>
<td><p>Pin 15</p></td>
<td><p>3</p></td>
<td><p>22</p></td>
</tr>
<tr class="row-even"><td><p>GPIO5</p></td>
<td><p>Pin 29</p></td>
<td><p>21</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>GPIO6</p></td>
<td><p>Pin 31</p></td>
<td><p>22</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-even"><td><p>GPIO13</p></td>
<td><p>Pin 33</p></td>
<td><p>23</p></td>
<td><p>13</p></td>
</tr>
</tbody>
</table>
<img alt="../_images/4.1.10_smart_fan_schematic.png" class="align-center" src="../_images/4.1.10_smart_fan_schematic.png" />
</section>
<section id="procedure-sperimentali">
<h2>Procedure Sperimentali<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#procedure-sperimentali" title="Link to this heading"></a></h2>
<p><strong>Passo 1:</strong> Assembla il circuito.</p>
<img alt="../_images/4.1.10_smart_fan_circuit.png" src="../_images/4.1.10_smart_fan_circuit.png" />
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Il modulo di alimentazione può utilizzare una batteria da 9V con il
connettore a clip incluso nel kit. Inserisci il ponticello del modulo
di alimentazione nelle strisce bus a 5V della breadboard.</p>
</div>
<img alt="../_images/4.1.10_smart_fan_battery.jpeg" class="align-center" src="../_images/4.1.10_smart_fan_battery.jpeg" />
<p><strong>Passo 2</strong>: Accedi alla cartella del codice.</p>
<run></run><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">davinci</span><span class="o">-</span><span class="n">kit</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="n">raspberry</span><span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="n">python</span><span class="o">-</span><span class="n">pi5</span>
</pre></div>
</div>
<p><strong>Passo 3</strong>: Esegui il codice.</p>
<run></run><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">python3</span> <span class="mf">3.1.4</span><span class="n">_SmartFan</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Quando il codice viene eseguito, avvia il ventilatore premendo il pulsante.
Ogni volta che premi, la velocità aumenta o diminuisce di un livello.
Ci sono <strong>5</strong> livelli di velocità: <strong>0~4</strong>. Quando è impostato al 4º livello
di velocità e premi il pulsante, il ventilatore si ferma con una velocità di <strong>0</strong>.</p>
<p>Se la temperatura aumenta o diminuisce di oltre 2°C, la velocità aumenta o
diminuisce automaticamente di 1 livello.</p>
</section>
<section id="codice">
<h2>Codice<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#codice" title="Link to this heading"></a></h2>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Puoi <strong>Modificare/Reimpostare/Copiare/Eseguire/Arrestare</strong> il codice qui sotto. Tuttavia, prima di farlo, devi accedere al percorso sorgente come <code class="docutils literal notranslate"><span class="pre">davinci-kit-for-raspberry-pi/python-pi5</span></code>. Dopo aver modificato il codice, puoi eseguirlo direttamente per vedere l’effetto.</p>
</div>
<run></run><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">from</span> <span class="nn">gpiozero</span> <span class="kn">import</span> <span class="n">Motor</span><span class="p">,</span> <span class="n">Button</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">ADC0834</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># Inizializza i pin GPIO per il pulsante e il controllo del motore</span>
<span class="n">BtnPin</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>
<span class="n">motor</span> <span class="o">=</span> <span class="n">Motor</span><span class="p">(</span><span class="n">forward</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">backward</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

<span class="c1"># Configura il modulo ADC0834 per il sensore di temperatura</span>
<span class="n">ADC0834</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

<span class="c1"># Inizializza le variabili per tracciare il livello di velocità del motore e le temperature</span>
<span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">currentTemp</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">markTemp</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">temperature</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads and calculates the current temperature from the sensor.</span>
<span class="sd">    Returns:</span>
<span class="sd">        float: The current temperature in Celsius.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Legge il valore analogico dal modulo ADC0834</span>
    <span class="n">analogVal</span> <span class="o">=</span> <span class="n">ADC0834</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
    <span class="c1"># Converte il valore analogico in tensione e poi in resistenza</span>
    <span class="n">Vr</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">analogVal</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="n">Rt</span> <span class="o">=</span> <span class="mi">10000</span> <span class="o">*</span> <span class="n">Vr</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">-</span> <span class="n">Vr</span><span class="p">)</span>
    <span class="c1"># Calcola la temperatura in gradi Celsius</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(((</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Rt</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">))</span> <span class="o">/</span> <span class="mi">3950</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">273.15</span> <span class="o">+</span> <span class="mi">25</span><span class="p">)))</span>
    <span class="n">Cel</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">-</span> <span class="mf">273.15</span>
    <span class="k">return</span> <span class="n">Cel</span>

<span class="k">def</span> <span class="nf">motor_run</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adjusts the motor speed based on the specified level.</span>
<span class="sd">    Args:</span>
<span class="sd">        level (int): Desired motor speed level.</span>
<span class="sd">    Returns:</span>
<span class="sd">        int: Adjusted motor speed level.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ferma il motore se il livello è 0</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">motor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="c1"># Imposta il limite massimo di velocità a 4</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="c1"># Imposta la velocità del motore</span>
    <span class="n">motor</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">level</span> <span class="o">/</span> <span class="mi">4</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">level</span>

<span class="k">def</span> <span class="nf">changeLevel</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Changes the motor speed level when the button is pressed and updates the reference temperature.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">level</span><span class="p">,</span> <span class="n">currentTemp</span><span class="p">,</span> <span class="n">markTemp</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Button pressed&quot;</span><span class="p">)</span>
    <span class="c1"># Cicla tra i livelli 0-4</span>
    <span class="n">level</span> <span class="o">=</span> <span class="p">(</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">5</span>
    <span class="c1"># Aggiorna la temperatura di riferimento</span>
    <span class="n">markTemp</span> <span class="o">=</span> <span class="n">currentTemp</span>

<span class="c1"># Associa l&#39;evento di pressione del pulsante alla funzione changeLevel</span>
<span class="n">BtnPin</span><span class="o">.</span><span class="n">when_pressed</span> <span class="o">=</span> <span class="n">changeLevel</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main function to continuously monitor and respond to temperature changes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">level</span><span class="p">,</span> <span class="n">currentTemp</span><span class="p">,</span> <span class="n">markTemp</span>
    <span class="c1"># Imposta la temperatura di riferimento iniziale</span>
    <span class="n">markTemp</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">()</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Legge continuamente la temperatura corrente</span>
        <span class="n">currentTemp</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">()</span>
        <span class="c1"># Regola il livello del motore in base alla differenza di temperatura</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">currentTemp</span> <span class="o">-</span> <span class="n">markTemp</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">markTemp</span> <span class="o">=</span> <span class="n">currentTemp</span>
            <span class="k">elif</span> <span class="n">currentTemp</span> <span class="o">-</span> <span class="n">markTemp</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">level</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">markTemp</span> <span class="o">=</span> <span class="n">currentTemp</span>
        <span class="c1"># Esegui il motore al livello regolato</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">motor_run</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>

<span class="c1"># Esegue la funzione principale e gestisce KeyboardInterrupt</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
    <span class="c1"># Ferma il motore quando lo script viene interrotto</span>
    <span class="n">motor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="spiegazione-del-codice">
<h2>Spiegazione del Codice<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#spiegazione-del-codice" title="Link to this heading"></a></h2>
<ol class="arabic">
<li><p>Importa le classi per gestire un motore e un pulsante, e la funzione sleep per introdurre delle pause. Inoltre, importa la libreria ADC0834 per il rilevamento della temperatura e la libreria math per i calcoli matematici.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">from</span> <span class="nn">gpiozero</span> <span class="kn">import</span> <span class="n">Motor</span><span class="p">,</span> <span class="n">Button</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">ADC0834</span>
<span class="kn">import</span> <span class="nn">math</span>
</pre></div>
</div>
</li>
<li><p>Configura il pulsante sul pin GPIO 22 e imposta il motore con specifici pin GPIO per il controllo. Inizializza il modulo ADC0834 per la misurazione della temperatura. Inizializza inoltre le variabili per monitorare il livello di velocità del motore e le temperature.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Inizializza i pin GPIO per il controllo del pulsante e del motore</span>
<span class="n">BtnPin</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>
<span class="n">motor</span> <span class="o">=</span> <span class="n">Motor</span><span class="p">(</span><span class="n">forward</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">backward</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

<span class="c1"># Configura il modulo ADC0834 per il rilevamento della temperatura</span>
<span class="n">ADC0834</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

<span class="c1"># Inizializza le variabili per tracciare il livello di velocità del motore e le temperature</span>
<span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">currentTemp</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">markTemp</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
<li><p>Definisce una funzione per leggere e calcolare la temperatura dal sensore, convertendo il valore letto in gradi Celsius.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">temperature</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads and calculates the current temperature from the sensor.</span>
<span class="sd">    Returns:</span>
<span class="sd">        float: The current temperature in Celsius.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Legge il valore analogico dal modulo ADC0834</span>
    <span class="n">analogVal</span> <span class="o">=</span> <span class="n">ADC0834</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
    <span class="c1"># Converte il valore analogico in tensione e poi in resistenza</span>
    <span class="n">Vr</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">analogVal</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="n">Rt</span> <span class="o">=</span> <span class="mi">10000</span> <span class="o">*</span> <span class="n">Vr</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">-</span> <span class="n">Vr</span><span class="p">)</span>
    <span class="c1"># Calcola la temperatura in gradi Celsius</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(((</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Rt</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">))</span> <span class="o">/</span> <span class="mi">3950</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">273.15</span> <span class="o">+</span> <span class="mi">25</span><span class="p">)))</span>
    <span class="n">Cel</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">-</span> <span class="mf">273.15</span>
    <span class="k">return</span> <span class="n">Cel</span>
</pre></div>
</div>
</li>
<li><p>Introduce una funzione per regolare la velocità del motore in base al livello specificato.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">motor_run</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adjusts the motor speed based on the specified level.</span>
<span class="sd">    Args:</span>
<span class="sd">        level (int): Desired motor speed level.</span>
<span class="sd">    Returns:</span>
<span class="sd">        int: Adjusted motor speed level.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ferma il motore se il livello è 0</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">motor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="c1"># Limita il livello a 4 per la velocità massima</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="c1"># Imposta la velocità del motore</span>
    <span class="n">motor</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">level</span> <span class="o">/</span> <span class="mi">4</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">level</span>
</pre></div>
</div>
</li>
<li><p>Implementa una funzione per cambiare manualmente il livello di velocità del motore utilizzando un pulsante e collega questa funzione all’evento di pressione del pulsante.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">changeLevel</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Changes the motor speed level when the button is pressed and updates the reference temperature.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">level</span><span class="p">,</span> <span class="n">currentTemp</span><span class="p">,</span> <span class="n">markTemp</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Button pressed&quot;</span><span class="p">)</span>
    <span class="c1"># Cicla attraverso i livelli 0-4</span>
    <span class="n">level</span> <span class="o">=</span> <span class="p">(</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">5</span>
    <span class="c1"># Aggiorna la temperatura di riferimento</span>
    <span class="n">markTemp</span> <span class="o">=</span> <span class="n">currentTemp</span>

<span class="c1"># Collega l’evento di pressione del pulsante alla funzione changeLevel</span>
<span class="n">BtnPin</span><span class="o">.</span><span class="n">when_pressed</span> <span class="o">=</span> <span class="n">changeLevel</span>
</pre></div>
</div>
</li>
<li><p>La funzione principale è progettata per regolare continuamente la velocità del motore in risposta alle variazioni di temperatura.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main function to continuously monitor and respond to temperature changes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">level</span><span class="p">,</span> <span class="n">currentTemp</span><span class="p">,</span> <span class="n">markTemp</span>
    <span class="c1"># Imposta la temperatura di riferimento iniziale</span>
    <span class="n">markTemp</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">()</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Legge continuamente la temperatura corrente</span>
        <span class="n">currentTemp</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">()</span>
        <span class="c1"># Regola il livello del motore in base alla differenza di temperatura</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">currentTemp</span> <span class="o">-</span> <span class="n">markTemp</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">markTemp</span> <span class="o">=</span> <span class="n">currentTemp</span>
            <span class="k">elif</span> <span class="n">currentTemp</span> <span class="o">-</span> <span class="n">markTemp</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">level</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">markTemp</span> <span class="o">=</span> <span class="n">currentTemp</span>
        <span class="c1"># Esegui il motore al livello regolato</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">motor_run</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Esegue la funzione principale e assicura che il motore si fermi se lo script viene interrotto.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Esegue la funzione principale e gestisce KeyboardInterrupt</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
    <span class="c1"># Ferma il motore quando lo script viene interrotto</span>
    <span class="n">motor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Piè di pagina">
        <a href="pi5_3.1.3_reversing_alarm_python.html" class="btn btn-neutral float-left" title="3.1.3 Allarme Retromarcia" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Precedente</a>
        <a href="pi5_3.1.5_battery_indicator_python.html" class="btn btn-neutral float-right" title="3.1.5 Indicatore di Batteria" accesskey="n" rel="next">Prossimo <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, SunFounder.</p>
  </div>

  Realizzato con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    fornito da <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>