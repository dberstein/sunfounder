

<!DOCTYPE html>
<html class="writer-html5" lang="fr" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="readthedocs-addons-api-version" content="1"><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>3.1.4 Ventilateur intelligent &mdash; Documentation SunFounder davinci-kit-for-raspberry-pi </title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css%3Fv=80d5e7a1.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css%3Fv=e59714d7.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css%3Fv=76b2166b.css" />
      <link rel="stylesheet" type="text/css" href="https://ezblock.cc/readDocFile/custom.css" />
      <link rel="stylesheet" type="text/css" href="https://ezblock.cc/readDocFile/readTheDoc/src/css/index.css" />
      <link rel="stylesheet" type="text/css" href="https://ezblock.cc/readDocFile/readTheDoc/src/css/xterm.css" />

  
      <script src="../_static/jquery.js%3Fv=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js%3Fv=2cd50e6c"></script>
      <script src="../_static/documentation_options.js%3Fv=d1a510d7"></script>
      <script src="../_static/doctools.js%3Fv=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js%3Fv=dc90522c"></script>
      <script src="../_static/clipboard.min.js%3Fv=a7894cd8"></script>
      <script src="../_static/copybutton.js%3Fv=f281be69"></script>
      <script src="../_static/translations.js%3Fv=bf059b8c"></script>
      <script src="https://ezblock.cc/readDocFile/custom.js"></script>
      <script src="https://docs.sunfounder.com/projects/davinci-kit/fr/latest/_static/lang.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/ace.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/ext-language_tools.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/theme-chrome.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/mode-python.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/mode-sh.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/monokai.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/xterm.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/FitAddon.js"></script>
      <script src="https://ezblock.cc/readDocFile/readTheDoc/src/js/readTheDocIndex.js"></script>
    <script src="../_static/js/theme.js"></script>
    <script src="../_static/js/versions.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="3.1.5 Indicateur de Batterie" href="pi5_3.1.5_battery_indicator_python.html" />
    <link rel="prev" title="3.1.3 Alarme de Recul" href="pi5_3.1.3_reversing_alarm_python.html" /> 
<script async type="text/javascript" src="../../../../../_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="davinci-kit-fr" /><meta name="readthedocs-version-slug" content="latest" /><meta name="readthedocs-resolver-filename" content="/python_pi5/pi5_3.1.4_smart_fan_python.html" /><meta name="readthedocs-http-status" content="200" /></head>

<body class="wy-body-for-nav">
<nav id="nav-bar">
  <ul class="nav-bar-items" id="nav-bar-items">
    <li class="nav-bar-logo">
      <a href="https://sunfounder.com">
        <img class="logo-img" src="https://ezblock.cc/readDocFile/sunfounder_LOGO_160x@2x.png"/>
      </a>
    </li>
  </ul>
</nav>

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            SunFounder davinci-kit-for-raspberry-pi
          </a>
              <div class="switch-menus">
                <div class="version-switch"></div>
                <div class="language-switch"></div>
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">About this Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../component_list.html">Liste des composants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpio_extension_board.html">Carte d’extension GPIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../download_the_code.html">Download the Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install_setup_os/install_setup_os.html">Installer et Configurer le Système d’Exploitation Raspberry Pi</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../for_pi5.html">Pour le Pi 5</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="play_with_python_pi5.html">Jouez avec Python</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="check_the_gpiozero_python.html">Vérifiez l’installation de <code class="docutils literal notranslate"><span class="pre">GPIO</span> <span class="pre">Zero</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="pi5_output_python.html">Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="pi5_input_python.html">Input</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="pi5_extension_python.html">Extension</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.1_counting_device_python.html">3.1.1 Dispositif de Comptage</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.2_welcome_python.html">3.1.2 Bienvenue</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.3_reversing_alarm_python.html">3.1.3 Alarme de Recul</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="pi5_3.1.4_smart_fan_python.html#">3.1.4 Ventilateur intelligent</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.5_battery_indicator_python.html">3.1.5 Indicateur de Batterie</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.6_motion_control_python.html">3.1.6 Contrôle de Mouvement</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.7_traffic_light_python.html">3.1.7 Feu de Signalisation</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.8_overheat_monitor_python.html">3.1.8 Moniteur de surchauffe</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.9_password_lock_python.html">3.1.9 Serrure à Code</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.10_alarm_bell_python.html">3.1.10 Alarme Manuelle</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.11_morse_code_generator_python.html">3.1.11 Générateur de Code Morse</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.12_game_guess_number_python.html">3.1.12 JEU – Devine le Nombre</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.13_game_10_second_python.html">3.1.13 JEU – 10 Secondes</a></li>
<li class="toctree-l4"><a class="reference internal" href="pi5_3.1.14_game_not_not_python.html">3.1.14 JEU – Not Not</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../c_pi5/play_with_c.html">Play with C</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scratch_pi5/play_with_scratch.html">Jouer avec Scratch</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../for_other_models.html">Pour Pi 4, 3 et Tous les Autres Modèles de Pi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python_video/python_video.html">Cours vidéo Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/appendix.html">Appendice</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../thank-learning.html">Remerciements</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SunFounder davinci-kit-for-raspberry-pi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../for_pi5.html">Pour le Pi 5</a></li>
          <li class="breadcrumb-item"><a href="play_with_python_pi5.html">Jouez avec Python</a></li>
          <li class="breadcrumb-item"><a href="pi5_extension_python.html">Extension</a></li>
      <li class="breadcrumb-item active">3.1.4 Ventilateur intelligent</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/python_pi5/pi5_3.1.4_smart_fan_python.rst.txt" rel="nofollow"> Afficher la source de la page</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="admonition note">
<p class="admonition-title">Note</p>
<p>Bonjour et bienvenue dans la communauté SunFounder Raspberry Pi &amp; Arduino &amp; ESP32 sur Facebook ! Plongez plus profondément dans l’univers des Raspberry Pi, Arduino et ESP32 avec d’autres passionnés.</p>
<p><strong>Pourquoi nous rejoindre ?</strong></p>
<ul class="simple">
<li><p><strong>Support d’experts</strong> : Résolvez vos problèmes après-vente et surmontez les défis techniques grâce à l’aide de notre communauté et de notre équipe.</p></li>
<li><p><strong>Apprendre et Partager</strong> : Échangez des astuces et tutoriels pour améliorer vos compétences.</p></li>
<li><p><strong>Aperçus exclusifs</strong> : Profitez d’un accès anticipé aux annonces de nouveaux produits et d’aperçus en avant-première.</p></li>
<li><p><strong>Réductions spéciales</strong> : Bénéficiez de réductions exclusives sur nos nouveaux produits.</p></li>
<li><p><strong>Promotions et concours</strong> : Participez à des concours et profitez de promotions festives.</p></li>
</ul>
<p>👉 Prêt à explorer et à créer avec nous ? Cliquez sur [<a href="https://bit.ly/raphaelkit " target="_blank">Ici</a>] et rejoignez-nous dès aujourd’hui !</p>
</div>
<section id="ventilateur-intelligent">
<span id="py-pi5-fan"></span><h1>3.1.4 Ventilateur intelligent<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#ventilateur-intelligent" title="Lien vers cette rubrique"></a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#introduction" title="Lien vers cette rubrique"></a></h2>
<p>Dans ce projet, nous utiliserons des moteurs, des boutons et des thermistances pour
créer un ventilateur intelligent manuel et automatique dont la vitesse est réglable.</p>
</section>
<section id="composants-requis">
<h2>Composants requis<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#composants-requis" title="Lien vers cette rubrique"></a></h2>
<p>Pour ce projet, nous avons besoin des composants suivants.</p>
<a class="reference internal image-reference" href="../_images/4.1.10_smart_fan_list.png"><img alt="../_images/4.1.10_smart_fan_list.png" class="align-center" src="../_images/4.1.10_smart_fan_list.png" style="width: 800px;" />
</a>
</section>
<section id="schema-de-cablage">
<h2>Schéma de câblage<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#schema-de-cablage" title="Lien vers cette rubrique"></a></h2>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p>T-Board Name</p></td>
<td><p>physical</p></td>
<td><p>wiringPi</p></td>
<td><p>BCM</p></td>
</tr>
<tr class="row-even"><td><p>GPIO17</p></td>
<td><p>Pin 11</p></td>
<td><p>0</p></td>
<td><p>17</p></td>
</tr>
<tr class="row-odd"><td><p>GPIO18</p></td>
<td><p>Pin 12</p></td>
<td><p>1</p></td>
<td><p>18</p></td>
</tr>
<tr class="row-even"><td><p>GPIO27</p></td>
<td><p>Pin 13</p></td>
<td><p>2</p></td>
<td><p>27</p></td>
</tr>
<tr class="row-odd"><td><p>GPIO22</p></td>
<td><p>Pin 15</p></td>
<td><p>3</p></td>
<td><p>22</p></td>
</tr>
<tr class="row-even"><td><p>GPIO5</p></td>
<td><p>Pin 29</p></td>
<td><p>21</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>GPIO6</p></td>
<td><p>Pin 31</p></td>
<td><p>22</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-even"><td><p>GPIO13</p></td>
<td><p>Pin 33</p></td>
<td><p>23</p></td>
<td><p>13</p></td>
</tr>
</tbody>
</table>
<img alt="../_images/4.1.10_smart_fan_schematic.png" class="align-center" src="../_images/4.1.10_smart_fan_schematic.png" />
</section>
<section id="procedure-experimentale">
<h2>Procédure expérimentale<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#procedure-experimentale" title="Lien vers cette rubrique"></a></h2>
<p><strong>Étape 1 :</strong> Construisez le circuit.</p>
<img alt="../_images/4.1.10_smart_fan_circuit.png" src="../_images/4.1.10_smart_fan_circuit.png" />
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Le module d’alimentation peut être utilisé avec une pile 9V et la connexion
pour pile 9V fournie dans le kit. Insérez le cavalier du module d’alimentation
dans les bandes de bus 5V de la plaque d’expérimentation.</p>
</div>
<img alt="../_images/4.1.10_smart_fan_battery.jpeg" class="align-center" src="../_images/4.1.10_smart_fan_battery.jpeg" />
<p><strong>Étape 2 :</strong> Accédez au dossier du code.</p>
<run></run><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">davinci</span><span class="o">-</span><span class="n">kit</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="n">raspberry</span><span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="n">python</span><span class="o">-</span><span class="n">pi5</span>
</pre></div>
</div>
<p><strong>Étape 3 :</strong> Exécutez le programme.</p>
<run></run><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">python3</span> <span class="mf">3.1.4</span><span class="n">_SmartFan</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Lorsque le code est exécuté, démarrez le ventilateur en appuyant sur le bouton.
Chaque appui ajuste la vitesse d’un cran vers le haut ou vers le bas. Il existe
<strong>5</strong> niveaux de vitesse : <strong>0~4</strong>. Lorsque le ventilateur est réglé à la 4<sup>ème</sup>
vitesse et que vous appuyez à nouveau, le ventilateur s’arrête avec une vitesse de <strong>0</strong>.</p>
<p>Dès que la température augmente ou diminue de plus de 2°C, la vitesse augmente ou diminue
automatiquement d’un niveau.</p>
</section>
<section id="code">
<h2>Code<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#code" title="Lien vers cette rubrique"></a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Vous pouvez <strong>Modifier/Réinitialiser/Copier/Exécuter/Arrêter</strong> le code ci-dessous. Mais avant cela, vous devez vous rendre dans le répertoire source comme <code class="docutils literal notranslate"><span class="pre">davinci-kit-for-raspberry-pi/python-pi5</span></code>. Après avoir modifié le code, vous pouvez l’exécuter directement pour voir l’effet.</p>
</div>
<run></run><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">from</span> <span class="nn">gpiozero</span> <span class="kn">import</span> <span class="n">Motor</span><span class="p">,</span> <span class="n">Button</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">ADC0834</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># Initialisation des broches GPIO pour le bouton et le contrôle du moteur</span>
<span class="n">BtnPin</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>
<span class="n">motor</span> <span class="o">=</span> <span class="n">Motor</span><span class="p">(</span><span class="n">forward</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">backward</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

<span class="c1"># Initialisation du module ADC0834 pour la détection de température</span>
<span class="n">ADC0834</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

<span class="c1"># Initialisation des variables pour suivre le niveau de vitesse du moteur et les températures</span>
<span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">currentTemp</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">markTemp</span> <span class="o">=</span> <span class="mi">0</span>

<span class="k">def</span> <span class="nf">temperature</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads and calculates the current temperature from the sensor.</span>
<span class="sd">    Returns:</span>
<span class="sd">        float: The current temperature in Celsius.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Lire la valeur analogique depuis le module ADC0834</span>
    <span class="n">analogVal</span> <span class="o">=</span> <span class="n">ADC0834</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
    <span class="c1"># Conversion de la valeur analogique en tension puis en résistance</span>
    <span class="n">Vr</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">analogVal</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="n">Rt</span> <span class="o">=</span> <span class="mi">10000</span> <span class="o">*</span> <span class="n">Vr</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">-</span> <span class="n">Vr</span><span class="p">)</span>
    <span class="c1"># Calcul de la température en Celsius</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(((</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Rt</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">))</span> <span class="o">/</span> <span class="mi">3950</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">273</span><span class="p">,</span><span class="mi">15</span> <span class="o">+</span> <span class="mi">25</span><span class="p">)))</span>
    <span class="n">Cel</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">-</span> <span class="mi">273</span><span class="p">,</span><span class="mi">15</span>
    <span class="k">return</span> <span class="n">Cel</span>

<span class="k">def</span> <span class="nf">motor_run</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adjusts the motor speed based on the specified level.</span>
<span class="sd">    Args:</span>
<span class="sd">        level (int): Desired motor speed level.</span>
<span class="sd">    Returns:</span>
<span class="sd">        int: Adjusted motor speed level.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Arrêter le moteur si le niveau est 0</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">motor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="c1"># Limiter le niveau à 4 pour la vitesse maximale</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="c1"># Définir la vitesse du moteur</span>
    <span class="n">motor</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">level</span> <span class="o">/</span> <span class="mi">4</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">level</span>

<span class="k">def</span> <span class="nf">changeLevel</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Changes the motor speed level when the button is pressed and updates the reference temperature.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">level</span><span class="p">,</span> <span class="n">currentTemp</span><span class="p">,</span> <span class="n">markTemp</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Button pressed&quot;</span><span class="p">)</span>
    <span class="c1"># Passer à travers les niveaux 0-4</span>
    <span class="n">level</span> <span class="o">=</span> <span class="p">(</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">5</span>
    <span class="c1"># Mettre à jour la température de référence</span>
    <span class="n">markTemp</span> <span class="o">=</span> <span class="n">currentTemp</span>

<span class="c1"># Lier l&#39;événement de pression du bouton à la fonction changeLevel</span>
<span class="n">BtnPin</span><span class="o">.</span><span class="n">when_pressed</span> <span class="o">=</span> <span class="n">changeLevel</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main function to continuously monitor and respond to temperature changes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">level</span><span class="p">,</span> <span class="n">currentTemp</span><span class="p">,</span> <span class="n">markTemp</span>
    <span class="c1"># Définir la température de référence initiale</span>
    <span class="n">markTemp</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">()</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Lire en continu la température actuelle</span>
        <span class="n">currentTemp</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">()</span>
        <span class="c1"># Ajuster le niveau du moteur en fonction de la différence de température</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">currentTemp</span> <span class="o">-</span> <span class="n">markTemp</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">markTemp</span> <span class="o">=</span> <span class="n">currentTemp</span>
            <span class="k">elif</span> <span class="n">currentTemp</span> <span class="o">-</span> <span class="n">markTemp</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">level</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">markTemp</span> <span class="o">=</span> <span class="n">currentTemp</span>
        <span class="c1"># Faire tourner le moteur au niveau ajusté</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">motor_run</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>

<span class="c1"># Exécuter la fonction principale et gérer l&#39;interruption par clavier</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
    <span class="c1"># Arrêter le moteur lorsque le script est interrompu</span>
    <span class="n">motor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="explication-du-code">
<h2>Explication du Code<a class="headerlink" href="pi5_3.1.4_smart_fan_python.html#explication-du-code" title="Lien vers cette rubrique"></a></h2>
<ol class="arabic">
<li><p>Importe les classes pour gérer un moteur et un bouton, ainsi que la fonction <cite>sleep</cite> pour introduire des pauses. Le script importe également la bibliothèque ADC0834 pour la détection de température et la bibliothèque mathématique <cite>math</cite> pour effectuer des calculs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">from</span> <span class="nn">gpiozero</span> <span class="kn">import</span> <span class="n">Motor</span><span class="p">,</span> <span class="n">Button</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">ADC0834</span>
<span class="kn">import</span> <span class="nn">math</span>
</pre></div>
</div>
</li>
<li><p>Configure le bouton sur la broche GPIO 22 et initialise le moteur avec des broches GPIO spécifiques pour le contrôle. Initialise le module ADC0834 pour la mesure de la température. Définit également des variables pour suivre le niveau de vitesse du moteur et les températures.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialisation des broches GPIO pour le bouton et le contrôle du moteur</span>
<span class="n">BtnPin</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>
<span class="n">motor</span> <span class="o">=</span> <span class="n">Motor</span><span class="p">(</span><span class="n">forward</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">backward</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

<span class="c1"># Initialisation du module ADC0834 pour la détection de température</span>
<span class="n">ADC0834</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

<span class="c1"># Initialisation des variables pour suivre le niveau de vitesse du moteur et les températures</span>
<span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">currentTemp</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">markTemp</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
<li><p>Définit une fonction pour lire et calculer la température à partir du capteur, en convertissant la valeur lue en degrés Celsius.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">temperature</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads and calculates the current temperature from the sensor.</span>
<span class="sd">    Returns:</span>
<span class="sd">        float: The current temperature in Celsius.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Lire la valeur analogique depuis le module ADC0834</span>
    <span class="n">analogVal</span> <span class="o">=</span> <span class="n">ADC0834</span><span class="o">.</span><span class="n">getResult</span><span class="p">()</span>
    <span class="c1"># Convertir la valeur analogique en tension, puis en résistance</span>
    <span class="n">Vr</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">analogVal</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span>
    <span class="n">Rt</span> <span class="o">=</span> <span class="mi">10000</span> <span class="o">*</span> <span class="n">Vr</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span> <span class="o">-</span> <span class="n">Vr</span><span class="p">)</span>
    <span class="c1"># Calculer la température en Celsius</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(((</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Rt</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">))</span> <span class="o">/</span> <span class="mi">3950</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">273.15</span> <span class="o">+</span> <span class="mi">25</span><span class="p">)))</span>
    <span class="n">Cel</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">-</span> <span class="mf">273.15</span>
    <span class="k">return</span> <span class="n">Cel</span>
</pre></div>
</div>
</li>
<li><p>Introduit une fonction pour ajuster la vitesse du moteur en fonction du niveau spécifié.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">motor_run</span><span class="p">(</span><span class="n">level</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adjusts the motor speed based on the specified level.</span>
<span class="sd">    Args:</span>
<span class="sd">        level (int): Desired motor speed level.</span>
<span class="sd">    Returns:</span>
<span class="sd">        int: Adjusted motor speed level.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Arrête le moteur si le niveau est 0</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">motor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="c1"># Limite le niveau à 4 pour la vitesse maximale</span>
    <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">level</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="c1"># Définit la vitesse du moteur</span>
    <span class="n">motor</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">speed</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">level</span> <span class="o">/</span> <span class="mi">4</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">level</span>
</pre></div>
</div>
</li>
<li><p>Implémente une fonction pour changer le niveau de vitesse du moteur manuellement à l’aide d’un bouton, et lie cette fonction à l’événement de pression du bouton.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">changeLevel</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Changes the motor speed level when the button is pressed and updates the reference temperature.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">level</span><span class="p">,</span> <span class="n">currentTemp</span><span class="p">,</span> <span class="n">markTemp</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Button pressed&quot;</span><span class="p">)</span>
    <span class="c1"># Parcourt les niveaux 0-4</span>
    <span class="n">level</span> <span class="o">=</span> <span class="p">(</span><span class="n">level</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">5</span>
    <span class="c1"># Met à jour la température de référence</span>
    <span class="n">markTemp</span> <span class="o">=</span> <span class="n">currentTemp</span>

<span class="c1"># Lie l&#39;événement de pression du bouton à la fonction changeLevel</span>
<span class="n">BtnPin</span><span class="o">.</span><span class="n">when_pressed</span> <span class="o">=</span> <span class="n">changeLevel</span>
</pre></div>
</div>
</li>
<li><p>La fonction principale, conçue pour ajuster continuellement la vitesse du moteur en réponse aux variations de température, est implémentée ici.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main function to continuously monitor and respond to temperature changes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">level</span><span class="p">,</span> <span class="n">currentTemp</span><span class="p">,</span> <span class="n">markTemp</span>
    <span class="c1"># Définit la température de référence initiale</span>
    <span class="n">markTemp</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">()</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Lit en continu la température actuelle</span>
        <span class="n">currentTemp</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">()</span>
        <span class="c1"># Ajuste le niveau du moteur en fonction de la différence de température</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">currentTemp</span> <span class="o">-</span> <span class="n">markTemp</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="n">markTemp</span> <span class="o">=</span> <span class="n">currentTemp</span>
            <span class="k">elif</span> <span class="n">currentTemp</span> <span class="o">-</span> <span class="n">markTemp</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">level</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">markTemp</span> <span class="o">=</span> <span class="n">currentTemp</span>
        <span class="c1"># Fait tourner le moteur au niveau ajusté</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">motor_run</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Exécute la fonction principale et garantit que le moteur s’arrête si le script est interrompu.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Exécute la fonction principale et gère l&#39;interruption par clavier</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
    <span class="c1"># Arrête le moteur lorsque le script est interrompu</span>
    <span class="n">motor</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="pi5_3.1.3_reversing_alarm_python.html" class="btn btn-neutral float-left" title="3.1.3 Alarme de Recul" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Précédent</a>
        <a href="pi5_3.1.5_battery_indicator_python.html" class="btn btn-neutral float-right" title="3.1.5 Indicateur de Batterie" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Droits d'auteur 2025, SunFounder.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>